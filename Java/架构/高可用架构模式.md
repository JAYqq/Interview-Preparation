[TOC]



# 存储高可用架构模式

## 双机架构

双机架构包括了主备、主从、带双机切换的主备和主从、主主这几种模式，要注意一主多从这种架构已经不是双机架构范围，默认的主从这样的说法都是双机架构

### 主备

主机负责读写，备机负责备份数据

#### 优势

简单

#### 劣势

1. 从性能上没有改变读写的效率，都是主机在干活
2. 从灾备上看主机出现问题，需要人工干预

#### 场景

适合内部使用的系统，数据量少，访问量较小



### 主从

所谓的读写分离，主机负责写，从机负责读，这只是读多写少的场景，但往往这种场景是最多的

#### 优势

提高读写性能，从机也在干活

#### 劣势

1. 一样需要人工干预
2. 主从之间可能存在数据不一致问题
3. 客户端需要感知主从关系，将不同操作发给不同机器，复杂度上升



### 双机切换

目的是解决上面两种方案无法自动切换主机的弊端

你以为很简单，但是需要考虑的东西很多，主从或者主备切换，需要考虑：

1. 为什么切换？

   主机宕机、响应超时？这叫做 **切换时机的把握**

2. 怎么知道要切换？

   从机需要掌握主机的状态，也叫健康检测，这个检测是彼此互联还是第三方调度？这叫做 **状态传递**

3. 数据一致性？

   主机刚写一个数据，从机还没来得及复制就被迫切换，这不就丢了数据？

4. 主机唯一性？

   原主机恢复以后，从机还需要换回来吗？

针对状态传递，催生了几种架构：

#### 互联式

从机链接主机，主动或者被动获取主机状态

**缺点**

互联的网络不通后就产生了问题，这个网络问题是很大概率存在的



#### 中介式

交给第三方来管理状态，主从机自己汇报给第三方

**缺点**

第三方出问题后也是百搭，为了第三方的高可用，又要做架构模式，架构又会必然出现一些问题，因此业界有zk这样的工具帮助我们管理中介式的架构

####  模拟式

主从之间不多做状态交换，而是从机模拟客户端向主机发送读写信息判断主机是否健康

**缺点**

读写请求只能通过响应判断（响应时间、响应报文），然后互联式或者中介式可以有更多信息（IO负载、CPU负载、内存开销等）



### 主主架构

两个机器都是主机，可承担读写操作

#### 优点

读写性能更高，无需考虑切换问题

#### 缺点

数据存在多份，因此需要双向复制（这里还有一个双向复制死循环问题，可以考虑加上一个serverid）

#### 场景

适合对数据一致性比较低的场景，允许数据的丢失



### 